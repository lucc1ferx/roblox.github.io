!function(){"use strict";var e=Roblox,t=CoreRobloxUtilities,n="ItemPurchaseAjaxData",r="/games/",a="CommonUI.Controls",o="Feature.Premium",i="/v2/metadata/nextgen-purchase-status",l="/v1/products/{productId}/purchase",s="/v1/purchases/products/{productId}",c="/v1/products/{productId}",u="/purchase-warning/v1/purchase-warnings/acknowledge",d="Success",p=5e3,h={GAME_PASS:"Game Pass",BUNDLE:"Bundle",BUNDLE_ALIAS:"Package"},y="/v1/game-passes",E="/v1/bundles/thumbnails",v="/v1/assets",m={size:"150x150",format:"Png",isCircular:!1},f={backToShopAction:"Action.BackToShop",buyRobuxAndItemAction:"Action.BuyRobuxAndItem",cancelAction:"Action.Cancel",equipMyAvatarAction:"Action.EquipMyAvatar",goToRobuxStoreAction:"Action.GoToRobuxStore",insufficientRobuxHeading:"Heading.InsufficientRobux",insufficientRobuxMessage:"Message.InsufficientRobux",insufficientRobuxExceedLargestPackageMessage:"Message.InsufficientRobuxExceedLargestPackage",purchaseSucceededHeading:"Heading.PurchaseSucceeded",purchaseSucceededMessage:"Message.PurchaseSucceeded",purchaseSucceededRobuxBalanceMessage:"Message.PurchaseSucceededRobuxBalance",purchasingTheItemLabel:"Label.PurchasingTheItem",waitingForRobuxLabel:"Label.WaitingForRobux",errorOccuredHeading:"Heading.ErrorOccured",purchasingUnavailableMessage:"Message.PurchasingUnavailable",purchaseErrorOccuredMessage:"Message.PurchaseErrorOccured",okAction:"Action.Ok",commonUiOkAction:"Action.OK",commonUiCancelAction:"Action.Cancel",featurePremiumScaryModalTitleHeading:"Heading.ScaryModalTitle",featurePremiumScaryModalBodyNewDescription:"Description.ScaryModalBodyNew",featurePremiumScaryModalBody13To17Description:"Description.ScaryModalBody13To17",featurePremiumScaryModalThreshold1BodyDescription:"Description.ScaryModalThreshold1Body",featurePremiumScaryModalThreshold2BodyDescription:"Description.ScaryModalThreshold2Body"},P={U13PaymentModal:"U13PaymentModal",ParentalConsentWarningPaymentModal13To17:"ParentalConsentWarningPaymentModal13To17",ParentalAuthorization13To17:"ParentalAuthorization13To17",U13MonthlyThreshold1Modal:"U13MonthlyThreshold1Modal",RequireEmailVerification:"RequireEmailVerification",U13MonthlyThreshold2Modal:"U13MonthlyThreshold2Modal",NoAction:"NoAction"},U={EVENT_NAME:"ItemPurchaseUpsellEvent",CONTEXT_NAME:{COOKIE_PARSE_FAILED:"COOKIE_PARSE_FAILED",PRODUCT_INFO_REQUEST_FAILED:"PRODUCT_INFO_REQUEST_FAILED",PRODUCT_INFO_EMPTY:"PRODUCT_INFO_EMPTY",PRODUCT_ID_NOT_EXIST:"PRODUCT_ID_NOT_EXIST",UPSELL_FAILED:"UPSELL_FAILED"}},S="WebCatalog",T="WebBundle",A="WebGamePass",g="NoTypeParsedYet",b={UnknownError:"UnknownError",UnknownErrorNoAsset:"UnknownErrorNoAsset",UpsellShown:"UpsellShown",UpsellCancelled:"UpsellCancelled",UpsellCancelledFromU13Modal:"UpsellCancelledFromU13Modal",UpsellContinued:"UpsellContinued",UpsellThumbnailProcessFailed:"UpsellThumbnailProcessFailed",UpsellExceedLargestEntryPoint:"UpsellExceedLargestEntryPoint",UpsellExceedLargestShown:"UpsellExceedLargestShown",UpsellExceedLargestCancelled:"UpsellExceedLargestCancelled",UpsellExceedLargestGoToRobuxStoreClicked:"UpsellExceedLargestGoToRobuxStoreClicked",UpsellExceedLargestModalExpTrue:"UpsellExceedLargestModalExpTrue",UpsellExceedLargestModalExpFalse:"UpsellExceedLargestModalExpTrue",UpsellExceedLargestModalExpError:"UpsellExceedLargestModalExpError",UpsellExceedLargestMetadataError:"UpsellExceedLargestMetadataError",UpsellExceedLargestNoThumbnailImage:"UpsellExceedLargestNoThumbnailImage",UpsellFromGamesPage:"UpsellFromGamesPage",UpsellFailed:"UpsellFailed",UpsellFailedDueToNoAvailablePackage:"UpsellFailedDueToNoAvailablePackage",UpsellFailedDueToFailedPackageRequest:"UpsellFailedDueToFailedPackageRequest",AutoPurchaseEntryPoint:"AutoPurchaseEntryPoint",AutoPurchaseStarted:"AutoPurchaseStarted",AutoPurchaseSucceed:"AutoPurchaseSucceed",AutoPurchaseSucceedClose:"AutoPurchaseSucceedClose",AutoPurchaseSucceedBackToShop:"AutoPurchaseSucceedBackToShop",AutoPurchaseSucceedEquipMyAvatar:"AutoPurchaseSucceedEquipMyAvatar",AutoPurchaseFailed:"AutoPurchaseFailed",AutoPurchaseErrorFromPurchaseApi:"AutoPurchaseErrorFromPurchaseApi",AutoPurchaseFailedDueToStillLowBalance:"AutoPurchaseFailedDueToStillLowBalance",AutoPurchasePotentialHackingActionSpotted:"AutoPurchasePotentialHackingActionSpotted",AutoPurchasePotentialHackingActionSpotted2:"AutoPurchasePotentialHackingActionSpotted2",AutoPurchasePotentialHackingActionSpotted3:"AutoPurchasePotentialHackingActionSpotted3",AutoPurchasePotentialHackingActionSpotted4:"AutoPurchasePotentialHackingActionSpotted4",ShowU13PaymentModal:"ShowU13PaymentModal",ShowU13MonthlyThreshold1Modal:"ShowU13MonthlyThreshold1Modal",ShowU13MonthlyThreshold2Modal:"ShowU13MonthlyThreshold2Modal",ShowParentalConsentWarningPaymentModal13To17Modal:"ShowParentalConsentWarningPaymentModal13To17Modal",ConfirmU13PaymentModal:"ConfirmU13PaymentModal",ConfirmU13MonthlyThreshold1Modal:"ConfirmU13MonthlyThreshold1Modal",ConfirmU13MonthlyThreshold2Modal:"ConfirmU13MonthlyThreshold2Modal",ConfirmParentalConsentWarningPaymentModal13To17Modal:"ConfirmParentalConsentWarningPaymentModal13To17Modal",U13PaymentModalEmailVerificationTriggered:"U13PaymentModalEmailVerificationTriggered",U13PaymentModalFailedToShow:"U13PaymentModalFailedToShow",U13PaymentModalNoAction:"U13PaymentModalNoAction"},w=CoreUtilities;function _(t,n){return void 0===n&&(n=!0),n?"<span class='icon-robux-16x16'></span><span class='text-robux'>"+e.NumberFormatting.commas(t)+"</span>":"<span class='icon-robux-gray-16x16'></span><span class='text'>"+e.NumberFormatting.commas(t)+"</span>"}function M(){var e;t.upsellUtil.expireUpsellCookie(),window.history&&((e=new URL(window.location.href)).searchParams.delete(t.upsellUtil.constants.UPSELL_QUERY_PARAM_KEY),e=e.href,window.history.pushState({path:e},"",e))}var I=function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},x=function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}},C=window.EventTracker?EventTracker:{fireEvent:console.log,start:console.log,endSuccess:console.log,endCancel:console.log,endFailure:console.log};function N(e){(0,C.fireEvent)(S+e)}function R(e,t){var n;t===h.BUNDLE||t===h.BUNDLE_ALIAS?(n=e,(0,C.fireEvent)(T+n)):t===h.GAME_PASS?(n=e,(0,C.fireEvent)(A+n)):N(t?e:b.UnknownErrorNoAsset)}function L(e){t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.PURCHASE_WARNING,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.VIEW_SHOWN,e)}function F(n,r,i,l,s){var c;return function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))}(this,void 0,void 0,(function(){var d;return function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(h){switch(h.label){case 0:if(!r)return i(),[2,Promise.resolve()];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,function(t){return function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))}(this,void 0,Promise,(function(){var n,r,a;return function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(o){switch(o.label){case 0:r=!e.CurrentUser.isPremiumUser,n={productId:t,is13To17ScaryModalEnabled:r},r={url:e.EnvironmentUrls.apiGatewayUrl+"/purchase-warning/v1/purchase-warnings",withCredentials:!0,timeout:p},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,w.httpService.get(r,n)];case 2:return 200===(a=o.sent()).status&&a.data.action?[2,Promise.resolve(a.data.action)]:[2,Promise.resolve(P.NoAction)];case 3:return a=o.sent(),[2,Promise.reject(a)];case 4:return[2]}}))}))}(n.roblox_product_id)];case 2:return(d=h.sent())===P.U13PaymentModal||d===P.ParentalConsentWarningPaymentModal13To17||d===P.U13MonthlyThreshold1Modal||d===P.U13MonthlyThreshold2Modal?(d===P.U13PaymentModal?(L(t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.U13_PAYMENT_MODAL),R(b.ShowU13PaymentModal,null==s?void 0:s.assetType)):d===P.U13MonthlyThreshold1Modal?(L(t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.U13_MONTHLY_THRESHOLD_1_MODAL),R(b.ShowU13MonthlyThreshold1Modal,null==s?void 0:s.assetType)):d===P.U13MonthlyThreshold2Modal?(L(t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.U13_MONTHLY_THRESHOLD_2_MODAL),R(b.ShowU13MonthlyThreshold2Modal,null==s?void 0:s.assetType)):(L(t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.PAYMENT_MODAL_13_TO_17),R(b.ShowParentalConsentWarningPaymentModal13To17Modal,null==s?void 0:s.assetType)),function(t,n,r,i,l){var s=i.getTranslationResource(o),c=i.getTranslationResource(a),d=(i={lineBreak:d="<br /><br />",linebreak:d},"");n===P.U13PaymentModal?d=s.get(f.featurePremiumScaryModalBodyNewDescription,i):n===P.ParentalConsentWarningPaymentModal13To17?d=s.get(f.featurePremiumScaryModalBody13To17Description,{}):n===P.U13MonthlyThreshold1Modal?d=s.get(f.featurePremiumScaryModalThreshold1BodyDescription,i):n===P.U13MonthlyThreshold2Modal&&(d=s.get(f.featurePremiumScaryModalThreshold2BodyDescription,i)),e.Dialog.open({titleText:s.get(f.featurePremiumScaryModalTitleHeading,{}),bodyContent:'<div><span class="text-description">'+d+'</span></div><div class="text-center"><div class="icon-warning"></div></div>',declineText:c.get(f.commonUiCancelAction,{}),acceptText:c.get(f.commonUiOkAction,{}),onAccept:function(){return function(t,n){return I(this,void 0,Promise,(function(){var r,a;return x(this,(function(o){switch(o.label){case 0:a={acknowledgement:"Confirmed"+t},r={url:""+e.EnvironmentUrls.apiGatewayUrl+u,withCredentials:!0,timeout:p},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,w.httpService.post(r,a)];case 2:return o.sent(),n(),[2,Promise.resolve()];case 3:return a=o.sent(),[2,Promise.reject(a)];case 4:return[2]}}))}))}(n,r).then((function(){n===P.U13PaymentModal?R(b.ConfirmU13PaymentModal,null==l?void 0:l.assetType):n===P.U13MonthlyThreshold1Modal?R(b.ConfirmU13MonthlyThreshold1Modal,null==l?void 0:l.assetType):n===P.U13MonthlyThreshold2Modal?R(b.ConfirmU13MonthlyThreshold2Modal,null==l?void 0:l.assetType):R(b.ConfirmParentalConsentWarningPaymentModal13To17Modal,null==l?void 0:l.assetType)})).catch((function(){r()})),!1},onDecline:function(){return R(b.UpsellCancelledFromU13Modal,null==l?void 0:l.assetType),M(),!1},onCancel:function(){return R(b.UpsellCancelledFromU13Modal,null==l?void 0:l.assetType),M(),!1},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!1,fieldValidationRequired:!0,dismissable:!0,xToCancel:!0})}(0,d,i,l,s)):d===P.RequireEmailVerification?(R(b.U13PaymentModalEmailVerificationTriggered,null==s?void 0:s.assetType),null!==(c=e.EmailVerificationService.handleUserEmailVerificationRequiredByPurchaseWarning())&&void 0!==c&&c.then((function(e){L(t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.REQUIRE_EMAIL_VERIFICATION),null!=e&&e.emailAddress&&null!=e&&e.verified&&i()}))):(R(b.U13PaymentModalNoAction,null==s?void 0:s.assetType),i()),[2,Promise.resolve()];case 3:return d=h.sent(),[2,Promise.reject(d)];case 4:return[2]}}))}))}function O(n,r,a){var o=function(n){var r=t.upsellUtil.constants.UPSELL_TARGET_ITEM_URL_REGEX.exec(window.location.pathname);t.upsellUtil.constants.UPSELL_TARGET_ITEM_URL_REGEX.lastIndex=0;var a=null;if(Array.isArray(r)&&0<r.length&&(a=r[0]),!a)return"";if(!n||Object.keys(n).length<4)return"";var o=w.uuidService.generateRandomUuid();r=n.expectedCurrency+","+n.expectedPrice+","+n.expectedSellerId+","+(null!==(r=n.userassetId)&&void 0!==r?r:""),n=""+(n.productId||""),r=o+","+a+","+e.CurrentUser.userId+","+r+","+n;return(n=new Date).setHours(n.getHours()+1),n=[t.upsellUtil.constants.UPSELL_COOKIE_KEY,"=",encodeURIComponent(r),"; expires="+n.toUTCString(),"; path=/","; domain=.",e.EnvironmentUrls.domain,";"],document.cookie=n.join(""),o}(a);R(b.UpsellContinued,null==a?void 0:a.assetType),t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.GO_TO_ROBUX_PURCHASE_PAGE),window.location.href=e.Endpoints.getAbsoluteUrl("/upgrades/paymentmethods")+"?ap="+n.roblox_product_id+"&UpsellUuid="+o}function D(){var e=this;this.overlayDiv=null,this.contentDiv=null,this.loadingMessageSpan=null,this.spinnerSpan=null,this.loadingOverlayElementId="loading-overlay",this.show=function(t){var n=e.getOrCreateOverlayDiv();n=e.getOrCreateContentDiv(n);return e.getOrCreateSpinnerSpan(n),e.updateOrCreateMessage(t),e},this.hide=function(){var t;null!==(t=null===(t=e.spinnerSpan)||void 0===t?void 0:t.parentNode)&&void 0!==t&&t.removeChild(e.spinnerSpan),null!==(t=null===(t=e.loadingMessageSpan)||void 0===t?void 0:t.parentNode)&&void 0!==t&&t.removeChild(e.loadingMessageSpan),null!==(t=null===(t=e.contentDiv)||void 0===t?void 0:t.parentNode)&&void 0!==t&&t.removeChild(e.contentDiv),null!==(t=null===(t=e.overlayDiv)||void 0===t?void 0:t.parentNode)&&void 0!==t&&t.removeChild(e.overlayDiv),e.overlayDiv=null,e.contentDiv=null,e.spinnerSpan=null,e.loadingMessageSpan=null},this.updateMessage=function(t){e._loadingMessage=t,e.updateOrCreateMessage(t)},this.updateOrCreateMessage=function(t){var n;if(e.overlayDiv)return t?void(e.loadingMessageSpan?e.loadingMessageSpan.innerText=t:((n=document.createElement("span")).innerText=t,n.classList.add("loading-message"),e.getOrCreateContentDiv(e.overlayDiv).appendChild(n),e.loadingMessageSpan=n)):(null!==(n=null===(n=e.loadingMessageSpan)||void 0===n?void 0:n.parentNode)&&void 0!==n&&n.removeChild(e.loadingMessageSpan),void(e.loadingMessageSpan=null))},this.getOrCreateContentDiv=function(t){if(e.contentDiv)return e.contentDiv;var n=document.createElement("div");return n.classList.add("loading-overlay-content"),e.contentDiv=n,t.appendChild(n),n},this.getOrCreateOverlayDiv=function(){if(e.overlayDiv)return e.overlayDiv;var t=document.getElementById(e.loadingOverlayElementId);return t?e.overlayDiv=t:(t=document.createElement("div"),(e.overlayDiv=t).id=e.loadingOverlayElementId,t.classList.add("loading-overlay"),document.body.appendChild(t),t)},this.getOrCreateSpinnerSpan=function(t){if(e.spinnerSpan)return e.spinnerSpan;var n=document.createElement("span");return n.classList.add("spinner","spinner-default"),t.appendChild(n),e.spinnerSpan=n}}var G=(Object.defineProperty(D.prototype,"loadingMessage",{get:function(){return this._loadingMessage},enumerable:!1,configurable:!0}),D);function B(n){t.upsellUtil.expireUpsellCookie(),window.location.href=e.Endpoints.getAbsoluteUrl(n)}var k=function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},W=function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}},H=function(){return(H=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function V(t,n){try{e.EventStream.SendEventWithTarget(U.EVENT_NAME,t,n,e.EventStream.TargetTypes.WWW)}catch(t){}}var X=function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},j=function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};function Y(e){M(),B(e)}function q(t,n){return X(this,void 0,Promise,(function(){var r;return j(this,(function(a){switch(a.label){case 0:if(!n)return[2,Promise.reject()];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var n;return k(this,void 0,Promise,(function(){var r,a;return W(this,(function(o){switch(o.label){case 0:r=c.replace("{productId}",t),r={url:""+e.EnvironmentUrls.economyApi+r,withCredentials:!0},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,w.httpService.get(r)];case 2:return 200!==(a=o.sent()).status||a.data.reason!==d?[2,Promise.reject(null===(n=null==a?void 0:a.data)||void 0===n?void 0:n.reason)]:[2,Promise.resolve(a.data)];case 3:return a=o.sent(),[2,Promise.reject(a)];case 4:return[2]}}))}))}(n)];case 2:return(r=a.sent())&&0!==Object.keys(r).length?[2,r]:(R(b.AutoPurchasePotentialHackingActionSpotted3,g),V(U.CONTEXT_NAME.PRODUCT_INFO_EMPTY,{itemPath:t,productId:n}),[2,Promise.reject()]);case 3:return r=a.sent(),R(b.AutoPurchasePotentialHackingActionSpotted4,g),V(U.CONTEXT_NAME.PRODUCT_INFO_REQUEST_FAILED,{itemPath:t,productId:n,error:r}),[2,Promise.reject(r)];case 4:return[2]}}))}))}function K(n,r,a){return X(this,void 0,Promise,(function(){var o,i,l,s;return j(this,(function(c){switch(c.label){case 0:(s=t.upsellUtil.parseUpsellCookie())&&0!==Object.keys(s).length&&(!s.targetItemUrl||n.startsWith(s.targetItemUrl))||(R(b.AutoPurchasePotentialHackingActionSpotted2,g),V(U.CONTEXT_NAME.COOKIE_PARSE_FAILED,{itemPath:n,upsellCookieData:s}),Y(n)),(o=r)||Y(n),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,q(n,s.productId)];case 2:return i=c.sent(),[3,4];case 3:return l=c.sent(),V(U.CONTEXT_NAME.PRODUCT_ID_NOT_EXIST,{itemPath:n,upsellCookieData:s,error:l}),Y(n),[2,Promise.reject()];case 4:return[4,function(t,n){return function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))}(this,void 0,Promise,(function(){var r,a;return function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(o){switch(o.label){case 0:a=n===h.GAME_PASS?(r=y,{gamePassIds:t}):n===h.BUNDLE?(r=E,{bundleIds:t}):(r=v,{assetIds:t}),a=H(H({},a),m),r={url:""+e.EnvironmentUrls.thumbnailsApi+r,withCredentials:!0},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,w.httpService.get(r,a)];case 2:return 200===(a=o.sent()).status&&a.data.data&&0!==a.data.data.length?[2,Promise.resolve(a.data.data[0].imageUrl)]:[2,Promise.resolve(null)];case 3:return o.sent(),[2,Promise.resolve(null)];case 4:return[2]}}))}))}(i.assetId,i.assetType)];case 5:return l=c.sent(),o.imageurl=l||o.imageurl,s={expectedPrice:s.expectedPrice||"0",expectedCurrency:s.expectedCurrency||"1",expectedSellerId:s.expectedSellerId||"",itemId:i.assetId||(null==a?void 0:a.itemId),itemName:i.assetName||(null==a?void 0:a.itemName),assetType:i.assetType||(null==a?void 0:a.assetType),assetGranted:null==a?void 0:a.assetGranted,assetTypeDisplayName:i.assetTypeDisplayName||(null==a?void 0:a.assetTypeDisplayName),assetTypeId:null==a?void 0:a.assetTypeId,productId:i.productId||s.productId||(null==a?void 0:a.productId),itemType:i.assetType||(null==a?void 0:a.itemType),currentTime:null==a?void 0:a.currentTime,isPurchaseEnabled:null==a?void 0:a.isPurchaseEnabled,placeproductpromotionId:null==a?void 0:a.placeproductpromotionId,userassetId:s.userAssetId||(null==a?void 0:a.userassetId)},[2,[o,s]]}}))}))}function Q(n,a,o,i){var l="<span>"+o.get(f.purchaseSucceededRobuxBalanceMessage,{userRobuxBalance:_(a)})+"</span>";a="<div class='item-content'>\n        <div class='item-card-container item-preview'>\n          <div class='item-card-thumb'>\n            <img alt='item preview' src='"+n.itemThumbnailUrl+"'/>\n          </div>\n        </div>\n        <div class='text-center'>\n          "+o.get(f.purchaseSucceededMessage,{assetName:n.assetName})+"\n          "+l+"\n        </div>\n      </div>",l=n.assetType!==h.GAME_PASS?o.get(f.equipMyAvatarAction,{}):o.get(f.okAction,{});e.Dialog.open({titleText:o.get(f.purchaseSucceededHeading,{}),bodyContent:a,declineText:o.get(f.backToShopAction,{}),acceptText:l,acceptColor:"btn-primary-md",onAccept:function(){var a;return t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.PURCHASE_WARNING,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.OK),R(b.AutoPurchaseSucceedEquipMyAvatar,n.assetType),n.assetType!==h.GAME_PASS?void 0!==(a=e.Endpoints.getAbsoluteUrl("/my/avatar"))&&""!==a&&(t.upsellUtil.expireUpsellCookie(),window.location.href=a):n.itemPath.startsWith(r)?B(n.itemPath+"?#!/store"):B(n.itemPath),!1},onDecline:function(){return i.show(),t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.PURCHASE_WARNING,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),R(b.AutoPurchaseSucceedBackToShop,n.assetType),B(n.itemPath),!1},onCancel:function(){return i.show(),t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.PURCHASE_WARNING,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),R(b.AutoPurchaseSucceedClose,n.assetType),B(n.itemPath),!1},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!1,fieldValidationRequired:!0,showDecline:n.assetType!==h.GAME_PASS,dismissable:!1,xToCancel:!0})}function z(t,n){e.Dialog.open({titleText:n.get(f.errorOccuredHeading,{}),bodyContent:n.get(f.purchaseErrorOccuredMessage,{}),imageUrl:t.alertImageUrl,acceptText:n.get(f.okAction,{}),acceptColor:"btn-secondary-md",declineColor:"btn-none",dismissable:!0,allowHtmlContentInBody:!0})}var J=function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},Z=function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};function $(t,n,r,a){return J(this,void 0,Promise,(function(){var o,i,l,s,c,u;return Z(this,(function(d){switch(d.label){case 0:o={url:t,withCredentials:!0,retryable:!1,noCache:!0,noPragma:!0},d.label=1;case 1:return d.trys.push([1,3,,4]),i={expectedCurrency:n.expectedCurrency,expectedPrice:n.expectedPrice,expectedSellerId:n.expectedSellerId,expectedPromoId:n.expectedPromoId,userAssetId:n.userAssetId},[4,w.httpService.post(o,i)];case 2:return 500===(i=(i=d.sent()).data).statusCode?(R(b.AutoPurchaseErrorFromPurchaseApi,n.assetType),void 0===i.showDivID&&(i.showDivID=i.showDivId),void 0===i.AssetID&&(i.AssetID=i.assetId),r.hide(),(0,e.ItemPurchase)().openErrorView(i),M(),[2,Promise.resolve()]):(n.isLibrary&&e.EventStream&&e.UrlParser&&(p=i.assetId,h=e.CurrentUser&&e.CurrentUser.userId,y=e.UrlParser.getParametersAsObject(),l={assetId:p,category:y.Category,creatorId:y.CreatorId,genre:y.GenreCsv,page:y.Page,position:y.Position,searchKeyword:y.SearchKeyword,sortAggregation:y.SortAggregation,sortType:y.SortType,userId:h,searchId:y.SearchId},e.EventStream.SendEventWithTarget("LibraryAssetAcquired","Marketplace",l,e.EventStream.TargetTypes.WWW)),R(b.AutoPurchaseSucceed,n.assetType),r.hide(),s=n.userBalance-n.expectedPrice,Q(n,s,a,r),[2,Promise.resolve()]);case 3:if(l=d.sent(),r.hide(),R(b.AutoPurchaseFailed,n.assetType),"object"!=typeof(s=l)||!("responseText"in s.request))return[2,Promise.reject(s.request)];if("Bad Request"===(c=s.request).responseText)z(n,a);else try{u=JSON.parse(c.responseText),(0,e.ItemPurchase)().openErrorView(u),M()}catch(d){return[2,Promise.reject(d)]}return[2,Promise.reject(l)];case 4:return[2]}var p,h,y}))}))}function ee(t,n,r,a){var o;return void 0===n&&(n=void 0),J(this,void 0,Promise,(function(){var c,u,d,p;return Z(this,(function(y){switch(y.label){case 0:if(null!==(o=t.itemContainerElemClassList)&&void 0!==o&&o.contains("btn-disabled-primary"))return[2,Promise.resolve()];if(c=""+e.EnvironmentUrls.passProductPurchasingApi+l.replace("{productId}",t.productId),u=""+e.EnvironmentUrls.bundlesProductPurchasingApi+l.replace("{productId}",t.productId),d=""+e.EnvironmentUrls.economyApi+s.replace("{productId}",t.productId),n)return[2,n({productId:t.productId,expectedPrice:t.expectedPrice,expectedCurrency:t.expectedCurrency,expectedPromoId:null===(o=t.expectedPromoId)||void 0===o?void 0:o.toString(),expectedSellerId:t.expectedSellerId,userAssetId:null===(o=t.userAssetId)||void 0===o?void 0:o.toString()})];R(b.AutoPurchaseStarted,t.assetType),y.label=1;case 1:return y.trys.push([1,3,,4]),p={url:""+e.EnvironmentUrls.economyApi+i,withCredentials:!0},[4,w.httpService.get(p)];case 2:if(200===(p=y.sent()).status){if(p.data.isNextGenPassProductPurchasingEnabled&&t.assetType===h.GAME_PASS)return[2,$(c,t,r,a)];if(p.data.isNextGenBundlesProductPurchasingEnabled&&(t.assetType===h.BUNDLE||t.assetType===h.BUNDLE_ALIAS))return[2,$(u,t,r,a)]}return[3,4];case 3:return y.sent(),[3,4];case 4:return[2,$(d,t,r,a)]}}))}))}var te=function(e){return(e=null==(e=null==(e=document.querySelector('.PurchaseButton[data-product-id="'+e.productId+'"]'))?void 0:e.closest(".store-card"))?void 0:e.querySelector(".gear-passes-asset img"))?e.src:null},ne=function(e,t,n){if(void 0===n&&(n=window.location.pathname),n.startsWith(r)){if(!t)throw new Error("button data not exist");if(R(b.UpsellFromGamesPage,t.assetType),!(n=te(t)))throw R(b.UpsellThumbnailProcessFailed,t.assetType),new Error("thumbnail image url process failed");return n}return e.imageurl};var re=function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},ae=function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};function oe(){var t=this;this._state={purchased:!1,retryRemainTimes:5,timeoutHandle:null},this._checkBalanceAndPurchase=function(n,r){return re(t,void 0,Promise,(function(){var t,a=this;return ae(this,(function(o){switch(o.label){case 0:if(this._state.purchased)return[2,Promise.resolve()];o.label=1;case 1:return o.trys.push([1,5,,6]),t=this.translationResource.get(f.waitingForRobuxLabel,{}),this.loadingOverlay.updateMessage(t),[4,function(){return function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))}(this,void 0,Promise,(function(){var t,n;return function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(r){switch(r.label){case 0:t=e.CurrentUser.userId,t={url:""+e.EnvironmentUrls.economyApi+"/v1/users/{userId}/currency".replace("{userId}",t),withCredentials:!0,retryable:!1,noCache:!0},r.label=1;case 1:return r.trys.push([1,3,,4]),[4,w.httpService.get(t)];case 2:return 200===(n=r.sent()).status?[2,n.data.robux]:[2,Promise.reject()];case 3:return n=r.sent(),[2,Promise.reject(n)];case 4:return[2]}}))}))}()];case 2:return t=o.sent(),(n.userBalance=t)>=n.expectedPrice?[4,ee(n,r,this.loadingOverlay,this.translationResource)]:[3,4];case 3:o.sent(),this._stopPeriodicChecking(),this._state.purchased=!0,o.label=4;case 4:return this._state.purchased||(0<this._state.retryRemainTimes?(this._state.timeoutHandle=setTimeout((function(){return re(a,void 0,void 0,(function(){return ae(this,(function(e){switch(e.label){case 0:return[4,this._checkBalanceAndPurchase(n,r)];case 1:return e.sent(),[2]}}))}))}),5e3),--this._state.retryRemainTimes):(R(b.AutoPurchaseFailedDueToStillLowBalance,null==n?void 0:n.assetType),this._processGenericErrorState(n))),[3,6];case 5:return o.sent(),R(b.AutoPurchaseFailed,null==n?void 0:n.assetType),this._processGenericErrorState(n),[3,6];case 6:return[2,Promise.resolve()]}}))}))},this._stopPeriodicChecking=function(){t._state.timeoutHandle&&(clearTimeout(t._state.timeoutHandle),t._state.timeoutHandle=null)},this._processGenericErrorState=function(e){t.loadingOverlay.hide(),z(e,t.translationResource),M()},this.intl=new e.Intl,this.intlProvider=new e.TranslationResourceProvider(this.intl),this.translationResource=this.intlProvider.getTranslationResource("Purchasing.PurchaseDialog"),this.loadingOverlay=new G}var ie=(oe.prototype.startItemUpsellProcess=function(r,a,o,i){var l,s,c;return void 0===i&&(i=null===(l=document.getElementById(n))||void 0===l?void 0:l.dataset),re(this,void 0,Promise,(function(){var n,l,u;return ae(this,(function(d){switch(d.label){case 0:if(!(n=i))return o(r),[2,Promise.reject(r)];if(l=t.upsellUtil.constants.UPSELL_TARGET_ITEM_URL_REGEX.exec(window.location.pathname),t.upsellUtil.constants.UPSELL_TARGET_ITEM_URL_REGEX.lastIndex=0,!Array.isArray(l))return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,function(t,n){return function(e,t,n,r){return new(n=n||Promise)((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))}(this,void 0,Promise,(function(){var r,a;return function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i={next:l(0),throw:l(1),return:l(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}(this,(function(o){switch(o.label){case 0:r=parseInt(t.userBalanceRobux,10),a={upsell_platform:"WEB",user_robux_balance:r,attempt_robux_amount:n.expectedItemPrice},r={url:e.EnvironmentUrls.apiGatewayUrl+"/payments-gateway/v1/products/get-upsell-product",withCredentials:!0},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,w.httpService.post(r,a)];case 2:return[2,o.sent()];case 3:return a=o.sent(),[2,Promise.reject(a)];case 4:return[2]}}))}))}(n,a)];case 2:return 200===(u=d.sent()).status?(t.paymentFlowAnalyticsService.startRobuxUpsellFlow(null!==(s=null===(s=a.buyButtonElementDataset)||void 0===s?void 0:s.assetType)&&void 0!==s?s:"",!(null===(s=a.buyButtonElementDataset)||void 0===s||!s.userassetId),null!==(s=null===(s=a.buyButtonElementDataset)||void 0===s?void 0:s.isPrivateServer)&&void 0!==s&&s,null!==(s=null===(s=a.buyButtonElementDataset)||void 0===s?void 0:s.isPlace)&&void 0!==s&&s),n.thumbnailImageUrl=ne(n,a.buyButtonElementDataset),p=r,h=a,y=n,E=u.data,v=this.intl,m=this.translationResource,P=this.intlProvider,U=_(p.shortfallPrice,!1),S=_(E.robux_amount),p=_(h.expectedItemPrice),v="<a class='text-link-secondary terms-of-use-link' target='_blank' href='"+w.urlService.getUrlWithLocale("/info/terms",v.getRobloxLocale())+"'>",S="<div class='item-card-container item-preview'>\n        <div class='item-card-thumb'>\n          <img alt='item preview' src='"+(null!==(y=y.thumbnailImageUrl)&&void 0!==y?y:"")+"' />\n        </div>\n        <div class='item-info text-name'>\n        <div class='text-overflow item-card-name'>"+(0,w.escapeHtml)()(h.assetName)+"</div>\n          <div class='text-robux item-card-price'>"+p+"</div>\n        </div>\n      </div>"+m.get(f.insufficientRobuxMessage,{divTagStart:"<div class='modal-message-block text-center border-top'>",divTagEnd:"</div>",robuxNeeded:U,robuxPackageAmount:S,lineBreak:"",aTagStart:v,aTagEnd:"</a>"}),R(b.UpsellShown,null===(v=h.buyButtonElementDataset)||void 0===v?void 0:v.assetType),t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.VIEW_SHOWN),e.Dialog.open({titleText:m.get(f.insufficientRobuxHeading,{}),bodyContent:S,declineText:m.get(f.cancelAction,{}),acceptText:m.get(f.buyRobuxAndItemAction,{}),acceptColor:"btn-primary-md",onAccept:function(){return t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.BUY_ROBUX_AND_ITEM),F(E,e.CurrentUser.isUnder13,(function(){return O(E,0,h.buyButtonElementDataset)}),P,h.buyButtonElementDataset).catch((function(){var e;R(b.U13PaymentModalFailedToShow,null===(e=h.buyButtonElementDataset)||void 0===e?void 0:e.assetType),O(E,0,h.buyButtonElementDataset)})),!1},onDecline:function(){var e;t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),R(b.UpsellCancelled,null===(e=h.buyButtonElementDataset)||void 0===e?void 0:e.assetType)},onCancel:function(){var e;t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),R(b.UpsellCancelled,null===(e=h.buyButtonElementDataset)||void 0===e?void 0:e.assetType)},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!1,fieldValidationRequired:!0,dismissable:!0,xToCancel:!0}),[2,Promise.resolve()]):(204===u.status?R(b.UpsellFailedDueToNoAvailablePackage,null===(s=a.buyButtonElementDataset)||void 0===s?void 0:s.assetType):R(b.UpsellFailedDueToFailedPackageRequest,null===(c=a.buyButtonElementDataset)||void 0===c?void 0:c.assetType),[3,4]);case 3:return u=d.sent(),R(b.UpsellFailed,null===(c=a.buyButtonElementDataset)||void 0===c?void 0:c.assetType),o(r),[2,Promise.reject(u)];case 4:return o(r),[2,Promise.reject(r)]}var p,h,y,E,v,m,P,U,S}))}))},oe.prototype.showExceedLargestInsufficientRobuxModal=function(a,o,i,l){var s,c;void 0===l&&(l=null===(s=document.getElementById(n))||void 0===s?void 0:s.dataset),R(b.UpsellExceedLargestEntryPoint,null==o?void 0:o.assetType);var u=l;if(null==u||!u.imageurl)return R(b.UpsellExceedLargestNoThumbnailImage,null==o?void 0:o.assetType),void i();try{t.paymentFlowAnalyticsService.startRobuxUpsellFlow(null!==(c=null==o?void 0:o.assetType)&&void 0!==c?c:"",!(null==o||!o.userassetId),null!==(c=null==o?void 0:o.isPrivateServer)&&void 0!==c&&c,null!==(c=null==o?void 0:o.isPlace)&&void 0!==c&&c),function(n,a,o,i){var l=_(n),s=_(parseInt(o.expectedPrice,10));n=a,window.location.pathname.startsWith(r)&&(n=null!==(a=te(o))&&void 0!==a?a:n),l="<div class='item-card-container item-preview'>\n        <div class='item-card-thumb'>\n          <img alt='item preview' src='"+n+"' />\n        </div>\n        <div class='item-info text-name'>\n        <div class='text-overflow item-card-name'>"+(0,w.escapeHtml)()(o.itemName)+"</div>\n          <div class='text-robux item-card-price'>"+s+"</div>\n        </div>\n      </div>"+i.get(f.insufficientRobuxExceedLargestPackageMessage,{divTagStart:"<div class='modal-message-block text-center border-top'>",divTagEnd:"</div>",robuxNeeded:l}),t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL_EXCEED_LARGEST_PACKAGE,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.VIEW_SHOWN),R(b.UpsellExceedLargestShown,o.assetType),e.Dialog.open({titleText:i.get(f.insufficientRobuxHeading,{}),bodyContent:l,declineText:i.get(f.cancelAction,{}),acceptText:i.get(f.goToRobuxStoreAction,{}),acceptColor:"btn-primary-md",onAccept:function(){return t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL_EXCEED_LARGEST_PACKAGE,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.GO_TO_ROBUX_STORE),R(b.UpsellExceedLargestGoToRobuxStoreClicked,null==o?void 0:o.assetType),window.location.href=e.Endpoints.getAbsoluteUrl("/upgrades/robux?ctx=upsell"),!1},onDecline:function(){t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL_EXCEED_LARGEST_PACKAGE,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),R(b.UpsellExceedLargestCancelled,null==o?void 0:o.assetType)},onCancel:function(){t.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(t.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,t.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL_EXCEED_LARGEST_PACKAGE,t.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,t.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),R(b.UpsellCancelled,null==o?void 0:o.assetType)},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!1,fieldValidationRequired:!0,dismissable:!0,xToCancel:!0})}(a,u.imageurl,o,this.translationResource),R(b.UpsellExceedLargestModalExpTrue,null==o?void 0:o.assetType)}catch(a){R(b.UpsellExceedLargestModalExpError,null==o?void 0:o.assetType),i()}},oe.prototype.initiateAutoPurchase=function(a,o,i,l){var s;return void 0===i&&(i=document.getElementById(n)),void 0===l&&(l=document.getElementById("item-container")),re(this,void 0,Promise,(function(){var n,c,u,d;return ae(this,(function(p){switch(p.label){case 0:return this._state={purchased:!1,retryRemainTimes:5,timeoutHandle:null},this.loadingOverlay.show(),R(b.AutoPurchaseEntryPoint,g),function(n){n&&(n.startsWith("/catalog/")||n.startsWith("/bundles/")||n.startsWith("/game-pass/")||n.startsWith(r))&&!n.includes("UpsellUuid=")||(t.upsellUtil.expireUpsellCookie(),window.location.href=e.Endpoints.getAbsoluteUrl("/catalog"))}(a),[4,function(t,n,r,a){return X(this,void 0,Promise,(function(){var o,i,l,s,c,u,d,p;return j(this,(function(h){switch(h.label){case 0:return[4,K(a,r,n)];case 1:return u=h.sent(),p=u[0],o=u[1],i=o.placeproductpromotionId,d=e.MetaDataValues&&e.MetaDataValues.getPageName()||"",l="LibraryItem"===d,s=parseInt(p.userBalanceRobux,10),c=parseInt(o.expectedCurrency,10),u=parseInt(o.expectedPrice,10),d=parseInt(o.expectedSellerId,10),p={itemContainerElemClassList:null==t?void 0:t.classList,assetType:o.assetType,assetName:(0,w.escapeHtml)()(o.itemName),expectedSellerId:d,expectedCurrency:c,expectedPrice:u,productId:o.productId,isLibrary:l,itemThumbnailUrl:p.imageurl,itemPath:a,alertImageUrl:p.alerturl,userBalance:s,itemPurchaseAjaxData:p,itemDetail:o},i&&(p.expectedPromoId=parseInt(i,10)),o.userassetId&&(p.userAssetId=parseInt(o.userassetId,10)),[2,p]}}))}))}(l,null==l?void 0:l.dataset,null==i?void 0:i.dataset,a)];case 1:n=p.sent(),d=this.translationResource.get(f.purchasingTheItemLabel,{}),c=n.userBalance,u=n.expectedPrice,p.label=2;case 2:return p.trys.push([2,6,,7]),a.startsWith(r)&&null!==(s=document.getElementById("tab-store"))&&void 0!==s&&s.click(),u<c?(this.loadingOverlay.updateMessage(d),[4,ee(n,o,this.loadingOverlay,this.translationResource)]):[3,4];case 3:return p.sent(),this._state.purchased=!0,[2,Promise.resolve()];case 4:return[4,this._checkBalanceAndPurchase(n,o)];case 5:return p.sent(),[3,7];case 6:return d=p.sent(),R(b.AutoPurchaseFailed,null==n?void 0:n.assetType),V(U.CONTEXT_NAME.UPSELL_FAILED,{itemPurchaseObj:n,error:d}),M(),[3,7];case 7:return[2,Promise.resolve()]}}))}))},oe);void 0===window.Roblox&&(window.Roblox={}),void 0===window.Roblox.ItemPurchaseUpsellService&&(window.Roblox.ItemPurchaseUpsellService=new ie)}(),window.Roblox&&window.Roblox.BundleDetector&&window.Roblox.BundleDetector.bundleDetected("ItemPurchaseUpsell");